<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0 , maximum-scale=1.0">
    <meta name="description" content="The world of RFID">
    <title>The world of RFID</title>

    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <script type="text/javascript" src="js/MQTTDetails.js"></script>

    <script type="text/javascript" src="lib/mqtt-4.3.7/mqtt.min.js"></script>
    <script type="text/javascript" src="lib/jQuery-3.6.0/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="lib/Popper-2.11.2/popper.js"></script>
    <script type="text/javascript" src="lib/bootstrap-5.0.2/js/bootstrap.min.js"></script>

    <link type="text/css" rel="stylesheet" href="lib/bootstrap-5.0.2/css/bootstrap.min.css">

    <link type="text/css" rel="stylesheet" href="css/main.css">
    <link type="text/css" rel="stylesheet" href="css/table.css">
    <link type="text/css" rel="stylesheet" href="css/layout.css">


    <!-- <link rel="stylesheet" media="screen and (min-width: 900px)" href="widescreen.css">
    <link rel="stylesheet" media="screen and (max-width: 600px)" href="smallscreen.css"> -->

</head>

<body onload="OnPageLoad();">

    <noscript><strong>We're sorry but this page doesn't work properly without JavaScript enabled. Please enable it to
            continue.</strong></noscript>

    <header>
        <div class="container-fluid p-3 bg-primary text-white text-center">
            <div>
                <svg id="Badge" width="30%" viewBox="0 0 300 80">
                    <g>
                        <rect x="68" y="0" style="fill:brown;" width="160" height="80" rx="20" ry="20" />

                        <rect x="0" y="16" style="fill:brown;" width="300" height="50" rx="25" ry="25" />

                        <rect x="72" y="4" style="fill:brown;stroke:white;stroke-width:2" width="152" height="72"
                            rx="17" ry="17" />

                        <rect x="4" y="20" style="fill:brown;stroke:white;stroke-width:2" width="292" height="42"
                            rx="22" ry="22" />

                        <text x="50" y="50" font-size="25" style="fill: white;">The world of RFID</text>
                    </g>
                </svg>
            </div>
            <div id="PageTitle"></div>
        </div>
    </header>

    <main>
        <section id="Layout">
            <span id="NewBlock-5" class="Block"></span>
            <span id="NewBlock-4" class="Block"></span>
            <span id="NewBlock-3" class="Block"></span>
            <span id="NewBlock-2" class="Block"></span>
            <span id="NewBlock-1" class="Block"></span>
            <span id="NewBlock-0" class="Block" style="display: none;"></span>

            <!-- https://www.sitepoint.com/how-to-translate-from-dom-to-svg-coordinates-and-back-again/ -->
            <!-- https://www.sarasoueidan.com/blog/svg-coordinate-systems/ -->

            <svg id="SVGLayout" xmlns="https://www.w3.org/2000/svg" viewbox="0 0 1350 250">
                <!-- viewbox="0 0 1920 1080" -->

                <g fill="none">
                    <path d="M10 50 l400 0" class="Track" />

                    <!-- <text x="160" y="70" class="TrackDetails">Block 1 (T)</text> -->
                    <text x="175" y="70" class="TrackDetails">Laurel</text>
                    <rect x="375" y="60" width="10" height="10" class="ReaderInActive" />

                    <line x1="410" y1="50" x2="460" y2="120" class="Track" />

                    <path d="M10 190 l400 0" class="Track" />
                    <!-- <text x="160" y="210" class="TrackDetails">Block 2 (T)</text> -->
                    <text x="175" y="210" class="TrackDetails">Hardy</text>
                    <rect x="375" y="200" width="10" height="10" class="ReaderInActive" />

                    <line x1="410" y1="190" x2="460" y2="120" class="Track" />

                    <path id="TrackBlock3" d="M460 120 l400 0" class="Track" />
                    <rect x="480" y="130" width="10" height="10" class="ReaderInActive" />
                    <!-- <text x="600" y="140" class="TrackDetails">(H) Block 3 (T)</text> -->
                    <text x="635" y="140" class="TrackDetails">Central</text>
                    <rect x="825" y="130" width="10" height="10" class="ReaderInActive" />

                    <path d="M930 50 l400 0" class="Track" />
                    <!-- <text x="1100" y="70" class="TrackDetails">(H) Block 4</text> -->
                    <text x="1110" y="70" class="TrackDetails">Eric</text>
                    <rect x="950" y="60" width="10" height="10" class="ReaderInActive" />

                    <line x1="860" y1="120" x2="930" y2="50" class="Track" />

                    <path id="TrackBlock5" d="M930 190 l400 0" class="Track" />
                    <!-- <text x="1100" y="210" class="TrackDetails">(H) Block 5</text> -->
                    <text x="1105" y="210" class="TrackDetails">Ernie</text>
                    <rect x="950" y="200" width="10" height="10" class="ReaderInActive" />

                    <line x1="860" y1="120" x2="930" y2="190" class="Track" />

                </g>
                Sorry, your browser does not support inline SVG.
            </svg>
        </section>

        <!-- https://medium.com/wdstack/how-the-bootstrap-grid-really-works-471d7a089cfc -->
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm d-flex justify-content-center">
                    <!-- <section> -->
                    <div>
                        Off Layout:
                        <table class="styled-table">
                            <thead>
                                <tr>
                                    <th>Stock#</th>
                                    <th>Picture</th>
                                </tr>
                            </thead>
                            <tbody id="OffTrackTableBody">
                            </tbody>
                        </table>
                    </div>
                    <!-- </section> -->
                </div>

                <div class="col-sm d-flex justify-content-center">
                    <!-- <section> -->
                    <div>
                        Stock Item Details:&nbsp;
                        <input type="button" value="Clear Details" onclick="actionClearDetailsView();" class="btn btn-primary"/>
                        <span id="StockItemDetails"></span>
                    </div>
                    <!-- </section> -->
                </div>
            </div>
        </div>

        <section id="MQTTStatus">
            <div>MQTT Status: <span id='status'></span>
                <!-- <div class="panel panel-default">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-6">Latest MQTT message:
                            <span id="messagetopic"> no message received</span>
                            <span id="messagepayload"> no message received</span>
                        </div>
                        <div class="col-md-6">MQTT Status: <span id='status'></span> '<span id='topic'></span>'
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            Output:
                        </div>
                    </div>
                </div>
            </div> -->
        </section>

    </main>

    <footer>
        <section style="display: block;">
            <br />
            <select id="MQTTServer" class="form-control-select" style="display: none;"></select>
            <select id="MQTTPort" class="form-control-select" style="display: none;"></select>
            <button onClick="MQTTChangeServer();" class="btn btn-primary">Force Re-connect</button>

            <!-- <input type="Button" value="Reload Data" onclick="actionLayoutControl('reload');" />
            <input type="Button" value="Reset Layout" onclick="actionLayoutControl('reset');" />
            <input type="Button" value="Start Positions" onclick="actionLayoutControl('startposition');" />
            <input type="Button" value="Start Test Sequence" onclick="actionLayoutControl('runsequence');" /> -->
            <!-- <input type="Button" value="Toggle Pictures" onclick="actionChangeStockItemView();" /> -->
        </section>
    </footer>

    <script>

        function getElement(id, type = 'unknown') {

            if (!this["cache_" + id]) {
                var item = document.getElementById(id);

                if (!item && type == 'stockitem') {
                    console.log("Element stockitem " + id + " not found, creating one");

                    var item = document.createElement("span");
                    item.setAttribute('stockitemid', id);
                    item.className = "stockitem mouseover";
                    item.addEventListener("click", actionGetStockItemDetails);

                    var itemimg = document.createElement("img");
                    // itemimg.className = "mouseover";
                    // itemimg.setAttribute('stockitemid', id);                    
                    //itemimg.setAttribute('src', "StockItemImages/" + id + "-sm.jpg");
                    itemimg.setAttribute('src', "StockItemImages/" + id + "-sm.gif");
                    // itemimg.addEventListener("click", actionGetStockItemDetails);

                    var itemtext = document.createElement("span");
                    itemtext.innerText = id;

                    item.append(itemimg);
                    item.append(itemtext);

                    // console.log ( StockItem );                    
                }

                console.log("Element " + id + " added to cache")
                this["cache_" + id] = item;
                // this["cache_" + id] = StockItem;
            }
            else {
                console.log("Element " + id + " found in cache")
            }
            return this["cache_" + id]
        }

        function actionClearDetailsView() {
            // $('#Block-6').text("")
            let str = "{  \"action\" : \"Show\", \"StockItem\" : \"\"}"

            MQTTSend('stockdetails', str);
        }

        function actionGetStockItemDetails(evt) {

            StockItemId = evt.currentTarget.getAttribute('stockitemid');

            let str = "{  \"action\" : \"Show\", \"StockItem\" : \"" + StockItemId + "\", \"details\" : { }}";

            MQTTSend('stockdetails', str);
        }

        function actionLayoutControl(strAction) {

            let str = "{ \"action\" : \"" + strAction + "\"}"

            MQTTSend('layoutcontrol', str);
        }

    </script>
</body>

</html>